-- 创建一个包含20维向量和一个整数的表
CREATE TABLE t1(v1 VECTOR(20), v2 integer);

-- 插入20维向量数据，确保每个浮点数都有三位小数且数据更多样
INSERT INTO t1 VALUES
(ARRAY [-1.234, 1.456, 2.345, -0.123, 0.234, -2.345, 3.456, 1.234, -1.111, 0.333, -0.444, 1.111, -2.222, 3.333, -1.000, 2.222, 0.111, -0.222, 1.000, 2.000], -1),
(ARRAY [-3.210, 1.320, 2.230, -0.120, 0.210, -2.120, 3.210, 1.120, -1.210, 0.320, -0.430, 1.230, -2.320, 3.120, -1.320, 2.210, 0.320, -0.210, 1.120, 2.120], -3),
(ARRAY [-2.123, 1.234, 2.345, -0.234, 0.345, -2.456, 3.567, 1.678, -1.789, 0.890, -0.901, 1.012, -2.123, 3.234, -1.345, 2.456, 0.567, -0.678, 1.789, 2.890], -2),
(ARRAY [-4.321, 1.432, 2.543, -0.654, 0.765, -2.876, 3.987, 1.098, -1.109, 0.210, -0.321, 1.432, -2.543, 3.654, -1.765, 2.876, 0.987, -0.098, 1.109, 2.210], -4),
(ARRAY [ 0.000, 1.001, 2.002, -0.003, 0.004, -2.005, 3.006, 1.007, -1.008, 0.009, -0.010, 1.011, -2.012, 3.013, -1.014, 2.015, 0.016, -0.017, 1.018, 2.019],  0),
(ARRAY [ 2.100, 1.200, 2.300, -0.400, 0.500, -2.600, 3.700, 1.800, -1.900, 0.100, -0.200, 1.300, -2.400, 3.500, -1.600, 2.700, 0.800, -0.900, 1.000, 2.100],  2),
(ARRAY [ 4.321, 1.231, 2.342, -0.453, 0.564, -2.675, 3.786, 1.897, -1.908, 0.919, -0.930, 1.041, -2.152, 3.263, -1.374, 2.485, 0.596, -0.707, 1.818, 2.929],  4),
(ARRAY [ 5.123, 1.234, 2.345, -0.456, 0.567, -2.678, 3.789, 1.890, -1.901, 0.912, -0.923, 1.034, -2.145, 3.256, -1.367, 2.478, 0.589, -0.600, 1.611, 2.722],  5),
(ARRAY [ 1.111, 2.222, 3.333, -1.000, 2.222, 0.111, -0.222, 1.000, 2.000, -1.234, 1.456, 2.345, -0.123, 0.234, -2.345, 3.456, 1.234, -1.111, 0.333, -0.444],  1),
(ARRAY [ 3.210, 1.320, 2.230, -0.120, 0.210, -2.120, 3.210, 1.120, -1.210, 0.320, -0.430, 1.230, -2.320, 3.120, -1.320, 2.210, 0.320, -0.210, 1.120, 2.120],  3),
(ARRAY [ 2.123, 1.234, 2.345, -0.234, 0.345, -2.456, 3.567, 1.678, -1.789, 0.890, -0.901, 1.012, -2.123, 3.234, -1.345, 2.456, 0.567, -0.678, 1.789, 2.890],  2),
(ARRAY [ 4.321, 1.432, 2.543, -0.654, 0.765, -2.876, 3.987, 1.098, -1.109, 0.210, -0.321, 1.432, -2.543, 3.654, -1.765, 2.876, 0.987, -0.098, 1.109, 2.210],  4),
(ARRAY [ 1.000, 2.000, 0.000, 1.001, 2.002, -0.003, 0.004, -2.005, 3.006, 1.007, -1.008, 0.009, -0.010, 1.011, -2.012, 3.013, -1.014, 2.015, 0.016, -0.017],  1),
(ARRAY [ 2.100, 1.200, 2.300, -0.400, 0.500, -2.600, 3.700, 1.800, -1.900, 0.100, -0.200, 1.300, -2.400, 3.500, -1.600, 2.700, 0.800, -0.900, 1.000, 2.100],  2),
(ARRAY [ 4.321, 1.231, 2.342, -0.453, 0.564, -2.675, 3.786, 1.897, -1.908, 0.919, -0.930, 1.041, -2.152, 3.263, -1.374, 2.485, 0.596, -0.707, 1.818, 2.929],  4),
(ARRAY [ 1.111, 2.222, 3.333, -1.000, 2.222, 0.111, -0.222, 1.000, 2.000, -1.234, 1.456, 2.345, -0.123, 0.234, -2.345, 3.456, 1.234, -1.111, 0.333, -0.444],  1),
(ARRAY [ 2.210, 1.320, 2.230, -0.120, 0.210, -2.120, 3.210, 1.120, -1.210, 0.320, -0.430, 1.230, -2.320, 3.120, -1.320, 2.210, 0.320, -0.210, 1.120, 2.120],  2),
(ARRAY [ 2.123, 1.234, 2.345, -0.234, 0.345, -2.456, 3.567, 1.678, -1.789, 0.890, -0.901, 1.012, -2.123, 3.234, -1.345, 2.456, 0.567, -0.678, 1.789, 2.890],  2),
(ARRAY [ 4.321, 1.432, 2.543, -0.654, 0.765, -2.876, 3.987, 1.098, -1.109, 0.210, -0.321, 1.432, -2.543, 3.654, -1.765, 2.876, 0.987, -0.098, 1.109, 2.210],  4),
(ARRAY [ 0.000, 1.001, 2.002, -0.003, 0.004, -2.005, 3.006, 1.007, -1.008, 0.009, -0.010, 1.011, -2.012, 3.013, -1.014, 2.015, 0.016, -0.017, 1.018, 2.019],  0),
(ARRAY [-1.234, 1.456, 2.345, -0.123, 0.234, -2.345, 3.456, 1.234, -1.111, 0.333, -0.444, 1.111, -2.222, 3.333, -1.000, 2.222, 0.111, -0.222, 1.000, 2.000], -1),
(ARRAY [-3.210, 1.320, 2.230, -0.120, 0.210, -2.120, 3.210, 1.120, -1.210, 0.320, -0.430, 1.230, -2.320, 3.120, -1.320, 2.210, 0.320, -0.210, 1.120, 2.120], -3),
(ARRAY [-2.123, 1.234, 2.345, -0.234, 0.345, -2.456, 3.567, 1.678, -1.789, 0.890, -0.901, 1.012, -2.123, 3.234, -1.345, 2.456, 0.567, -0.678, 1.789, 2.890], -2),
(ARRAY [-4.321, 1.432, 2.543, -0.654, 0.765, -2.876, 3.987, 1.098, -1.109, 0.210, -0.321, 1.432, -2.543, 3.654, -1.765, 2.876, 0.987, -0.098, 1.109, 2.210], -4),
(ARRAY [ 0.000, 1.001, 2.002, -0.003, 0.004, -2.005, 3.006, 1.007, -1.008, 0.009, -0.010, 1.011, -2.012, 3.013, -1.014, 2.015, 0.016, -0.017, 1.018, 2.019],  0),
(ARRAY [ 2.100, 1.200, 2.300, -0.400, 0.500, -2.600, 3.700, 1.800, -1.900, 0.100, -0.200, 1.300, -2.400, 3.500, -1.600, 2.700, 0.800, -0.900, 1.000, 2.100],  2),
(ARRAY [ 4.321, 1.231, 2.342, -0.453, 0.564, -2.675, 3.786, 1.897, -1.908, 0.919, -0.930, 1.041, -2.152, 3.263, -1.374, 2.485, 0.596, -0.707, 1.818, 2.929],  4),
(ARRAY [ 5.123, 1.234, 2.345, -0.456, 0.567, -2.678, 3.789, 1.890, -1.901, 0.912, -0.923, 1.034, -2.145, 3.256, -1.367, 2.478, 0.589, -0.600, 1.611, 2.722],  5),
(ARRAY [ 1.111, 2.222, 3.333, -1.000, 2.222, 0.111, -0.222, 1.000, 2.000, -1.234, 1.456, 2.345, -0.123, 0.234, -2.345, 3.456, 1.234, -1.111, 0.333, -0.444],  1),
(ARRAY [ 3.210, 1.320, 2.230, -0.120, 0.210, -2.120, 3.210, 1.120, -1.210, 0.320, -0.430, 1.230, -2.320, 3.120, -1.320, 2.210, 0.320, -0.210, 1.120, 2.120],  3),
(ARRAY [ 2.123, 1.234, 2.345, -0.234, 0.345, -2.456, 3.567, 1.678, -1.789, 0.890, -0.901, 1.012, -2.123, 3.234, -1.345, 2.456, 0.567, -0.678, 1.789, 2.890],  2),
(ARRAY [ 4.321, 1.432, 2.543, -0.654, 0.765, -2.876, 3.987, 1.098, -1.109, 0.210, -0.321, 1.432, -2.543, 3.654, -1.765, 2.876, 0.987, -0.098, 1.109, 2.210],  4),
(ARRAY [ 1.000, 2.000, 0.000, 1.001, 2.002, -0.003, 0.004, -2.005, 3.006, 1.007, -1.008, 0.009, -0.010, 1.011, -2.012, 3.013, -1.014, 2.015, 0.016, -0.017],  1),
(ARRAY [ 2.100, 1.200, 2.300, -0.400, 0.500, -2.600, 3.700, 1.800, -1.900, 0.100, -0.200, 1.300, -2.400, 3.500, -1.600, 2.700, 0.800, -0.900, 1.000, 2.100],  2),
(ARRAY [ 4.321, 1.231, 2.342, -0.453, 0.564, -2.675, 3.786, 1.897, -1.908, 0.919, -0.930, 1.041, -2.152, 3.263, -1.374, 2.485, 0.596, -0.707, 1.818, 2.929],  4),
(ARRAY [ 1.111, 2.222, 3.333, -1.000, 2.222, 0.111, -0.222, 1.000, 2.000, -1.234, 1.456, 2.345, -0.123, 0.234, -2.345, 3.456, 1.234, -1.111, 0.333, -0.444],  1),
(ARRAY [ 2.210, 1.320, 2.230, -0.120, 0.210, -2.120, 3.210, 1.120, -1.210, 0.320, -0.430, 1.230, -2.320, 3.120, -1.320, 2.210, 0.320, -0.210, 1.120, 2.120],  2),
(ARRAY [ 2.123, 1.234, 2.345, -0.234, 0.345, -2.456, 3.567, 1.678, -1.789, 0.890, -0.901, 1.012, -2.123, 3.234, -1.345, 2.456, 0.567, -0.678, 1.789, 2.890],  2),
(ARRAY [ 4.321, 1.432, 2.543, -0.654, 0.765, -2.876, 3.987, 1.098, -1.109, 0.210, -0.321, 1.432, -2.543, 3.654, -1.765, 2.876, 0.987, -0.098, 1.109, 2.210],  4),
(ARRAY [ 0.000, 1.001, 2.002, -0.003, 0.004, -2.005, 3.006, 1.007, -1.008, 0.009, -0.010, 1.011, -2.012, 3.013, -1.014, 2.015, 0.016, -0.017, 1.018, 2.019],  0);

-- 创建索引前
SELECT v1, v2, ARRAY [1.234, 1.456, 2.345, -0.123, 0.234, -2.345, 3.456, 1.234, -1.111, 0.333, -0.444, 1.111, -2.222, 3.333, -1.000, 2.222, 0.111, -0.222, 1.000, 2.000] <-> v1 as distance
FROM t1 ORDER BY ARRAY [1.234, 1.456, 2.345, -0.123, 0.234, -2.345, 3.456, 1.234, -1.111, 0.333, -0.444, 1.111, -2.222, 3.333, -1.000, 2.222, 0.111, -0.222, 1.000, 2.000] <-> v1 limit 10;

SELECT v1, v2, ARRAY [1.234, 1.456, 2.345, -0.123, 0.234, -2.345, 3.456, 1.234, -1.111, 0.333, -0.444, 1.111, -2.222, 3.333, -1.000, 2.222, 0.111, -0.222, 1.000, 2.000] <=> v1 as distance
FROM t1 ORDER BY ARRAY [1.234, 1.456, 2.345, -0.123, 0.234, -2.345, 3.456, 1.234, -1.111, 0.333, -0.444, 1.111, -2.222, 3.333, -1.000, 2.222, 0.111, -0.222, 1.000, 2.000] <=> v1 limit 10;

-- 创建索引，使用 HNSW 方法针对20维向量v1
CREATE INDEX t1v1hnsw ON t1 USING hnsw (v1 vector_l2_ops) WITH (m = 3, ef_construction = 3, ef_search = 3);

-- 执行查询，计算与给定20维向量的距离，并按距离排序
EXPLAIN (o) SELECT v1, v2, ARRAY [1.234, 1.456, 2.345, -0.123, 0.234, -2.345, 3.456, 1.234, -1.111, 0.333, -0.444, 1.111, -2.222, 3.333, -1.000, 2.222, 0.111, -0.222, 1.000, 2.000] <-> v1 as distance
FROM t1 ORDER BY ARRAY [1.234, 1.456, 2.345, -0.123, 0.234, -2.345, 3.456, 1.234, -1.111, 0.333, -0.444, 1.111, -2.222, 3.333, -1.000, 2.222, 0.111, -0.222, 1.000, 2.000] <-> v1 limit 10;

-- 创建索引后
SELECT v1, v2, ARRAY [1.234, 1.456, 2.345, -0.123, 0.234, -2.345, 3.456, 1.234, -1.111, 0.333, -0.444, 1.111, -2.222, 3.333, -1.000, 2.222, 0.111, -0.222, 1.000, 2.000] <-> v1 as distance
FROM t1 ORDER BY ARRAY [1.234, 1.456, 2.345, -0.123, 0.234, -2.345, 3.456, 1.234, -1.111, 0.333, -0.444, 1.111, -2.222, 3.333, -1.000, 2.222, 0.111, -0.222, 1.000, 2.000] <-> v1 limit 10;
